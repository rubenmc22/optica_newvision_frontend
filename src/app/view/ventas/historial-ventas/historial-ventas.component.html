<div class="card contenedor-generar-venta" style="margin-bottom: 0rem;">
    <!-- Header del m√≥dulo -->
    <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between">
        <h4 class="mb-0"> Historial de Ventas </h4>
        <div class="ms-auto">
            <button class="btn btn-light btn-sm" (click)="generarInforme()">
                <i class="bi bi-file-earmark-excel"></i> Generar Informe
            </button>
        </div>
    </div>



    <div class="card-body">
        <!-- Filtros y b√∫squedas -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row g-3 filtros-responsive">
                    <!-- Fila 1: Buscador, Asesor, Especialista -->
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">üîç Buscador</label>
                        <input type="text" class="form-control"
                            placeholder="C√©dula, nombre del paciente o N¬∞ de control..."
                            [(ngModel)]="filtros.busquedaGeneral" (input)="onFiltroChange()">
                    </div>

                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">üë®‚Äçüíº Asesor</label>
                        <select class="form-select" [(ngModel)]="filtros.asesor" (change)="onFiltroChange()">
                            <option value="">Todos</option>
                            <option *ngFor="let asesor of asesores" [value]="asesor.id">{{asesor.nombre}}</option>
                        </select>
                    </div>

                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">üë®‚Äç‚öïÔ∏è Especialista</label>
                        <select class="form-select" [(ngModel)]="filtros.especialista" (change)="onFiltroChange()">
                            <option value="">Todos</option>
                            <option *ngFor="let esp of especialistas" [value]="esp.id">{{esp.nombre}}</option>
                        </select>
                    </div>

                    <!-- Fila 2: Status, Rango de Fechas, Limpiar -->
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">üìä Status</label>
                        <select class="form-select" [(ngModel)]="filtros.estado" (change)="onFiltroChange()">
                            <option value="">Todos</option>
                            <option value="completada">‚úÖ Completada</option>
                            <option value="cancelada">‚ùå Cancelada</option>
                        </select>
                    </div>

                    <!-- Selector de Rango de Fechas y Bot√≥n Limpiar juntos -->
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">üìÖ Rango de fechas</label>
                        <div class="input-group">
                            <button class="btn btn-outline-primary" type="button" (click)="toggleDatepicker()">
                                <i class="bi bi-calendar-range me-1"></i>
                                <span class="fecha-display">{{ getFechaDisplay() }}</span>
                            </button>
                        </div>
                    </div>

                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold d-block text-center text-md-start"></label>
                        <div class="d-flex justify-content-center justify-content-md-end" style="margin-top: 20px;">
                            <button class="btn btn-outline-warning" type="button" (click)="limpiarFiltros()"
                                title="Restablecer todos los filtros">
                                <i class="bi bi-arrow-counterclockwise me-1"></i> Limpiar filtros
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Datepicker Flotante -->
        <div class="modal fade show" [class.d-block]="showDatepicker" tabindex="-1" *ngIf="showDatepicker">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Seleccionar rango de fechas</h5>
                        <button type="button" class="btn-close btn-close-white" (click)="closeDatepicker()"
                            style="color: white !important;"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <!-- Selector de fecha √∫nica -->
                            <div class="col-12">
                                <label class="form-label fw-semibold">üìå Fecha √∫nica</label>
                                <input type="date" class="form-control" [(ngModel)]="fechaUnica" [max]="maxDate"
                                    [min]="minDate" (change)="onFechaUnicaChange()">
                                <div class="form-text">Selecciona una fecha espec√≠fica</div>
                            </div>

                            <div class="col-12 text-center d-flex align-items-center justify-content-center">
                                <hr class="my-3">
                                <span class="text-muted">O selecciona un rango</span>
                            </div>

                            <!-- Rango de fechas -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Desde</label>
                                <input type="date" class="form-control" [max]="filtros.fechaHasta || maxDate"
                                    [min]="minDate" [(ngModel)]="filtros.fechaDesde" (change)="onRangoChange()">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Hasta</label>
                                <input type="date" class="form-control" [min]="filtros.fechaDesde || minDate"
                                    [max]="maxDate" [(ngModel)]="filtros.fechaHasta" (change)="onRangoChange()">
                            </div>

                            <!-- Presets r√°pidos -->
                            <div class="col-12">
                                <label class="form-label fw-semibold">Rangos predefinidos</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'hoy'"
                                        [class.btn-outline-secondary]="presetActivo !== 'hoy'"
                                        (click)="setRangoPreset('hoy')">
                                        Hoy
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'ayer'"
                                        [class.btn-outline-secondary]="presetActivo !== 'ayer'"
                                        (click)="setRangoPreset('ayer')">
                                        Ayer
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'semana'"
                                        [class.btn-outline-secondary]="presetActivo !== 'semana'"
                                        (click)="setRangoPreset('semana')">
                                        Esta semana
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'semana_pasada'"
                                        [class.btn-outline-secondary]="presetActivo !== 'semana_pasada'"
                                        (click)="setRangoPreset('semana_pasada')">
                                        Semana pasada
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'mes'"
                                        [class.btn-outline-secondary]="presetActivo !== 'mes'"
                                        (click)="setRangoPreset('mes')">
                                        Este mes
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'mes_pasado'"
                                        [class.btn-outline-secondary]="presetActivo !== 'mes_pasado'"
                                        (click)="setRangoPreset('mes_pasado')">
                                        Mes pasado
                                    </button>
                                    <button class="btn btn-sm" [class.btn-primary]="presetActivo === 'trimestre'"
                                        [class.btn-outline-secondary]="presetActivo !== 'trimestre'"
                                        (click)="setRangoPreset('trimestre')">
                                        Este trimestre
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" (click)="limpiarFechas()">
                            <i class="bi bi-x-circle me-1"></i> Limpiar
                        </button>
                        <button type="button" class="btn btn-primary" (click)="aplicarFechas()">
                            <i class="bi bi-check-circle me-1"></i> Aplicar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overlay para cerrar al hacer click fuera -->
        <div class="modal-backdrop fade show" *ngIf="showDatepicker" (click)="closeDatepicker()"></div>

        <!-- Controles de ordenamiento -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="d-flex align-items-center gap-2">
                <span class="text-muted">Ordenar por:</span>
                <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="ordenamiento.campo">
                    <option value="fecha">Fecha</option>
                    <option value="numeroControl">N¬∞ Control</option>
                    <option value="montoTotal">Monto Total</option>
                    <option value="paciente">Paciente</option>
                </select>
                <button class="btn btn-outline-secondary btn-sm" (click)="cambiarOrden()">
                    <i class="bi" [class.bi-arrow-up]="ordenamiento.ascendente"
                        [class.bi-arrow-down]="!ordenamiento.ascendente"></i>
                </button>
            </div>

            <div class="text-muted">
                Mostrando {{ventasFiltradas.length}} de {{totalVentas}} ventas
            </div>
        </div>

        <!-- Lista de ventas - Dise√±o Innovador -->
        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="ventas-grid">
                    <div *ngFor="let venta of ventasFiltradas" class="venta-card">
                        <!-- Tarjeta Principal -->
                        <div class="venta-header" (click)="toggleDetalleVenta(venta.id)">
                            <!-- Avatar y Info Principal -->
                            <div class="venta-avatar">
                                <div class="avatar-circle" [ngClass]="{
                            'avatar-success': venta.estado === 'completada',
                            'avatar-warning': venta.estado === 'pendiente',
                            'avatar-danger': venta.estado === 'cancelada'
                        }">
                                    <i class="bi" [class.bi-check-lg]="venta.estado === 'completada'"
                                        [class.bi-clock]="venta.estado === 'pendiente'"
                                        [class.bi-x-lg]="venta.estado === 'cancelada'"></i>
                                </div>
                            </div>

                            <!-- Informaci√≥n Central -->
                            <div class="venta-info">
                                <div class="venta-title">
                                    <h6 class="mb-1 fw-bold text-dark">{{venta.paciente.nombre}}</h6>
                                    <div class="venta-meta">
                                        <span class="meta-item">
                                            <i class="bi bi-person-badge text-muted"></i>
                                            CI. {{venta.paciente.cedula}}
                                        </span>
                                        <span class="meta-divider">‚Ä¢</span>
                                        <span class="meta-item">
                                            <i class="bi bi-calendar3 text-muted"></i>
                                            {{venta.fecha | date:'dd/MM/yyyy'}}
                                        </span>
                                        <span class="meta-divider">‚Ä¢</span>
                                        <span class="meta-item">
                                            <i class="bi bi-clock text-muted"></i>
                                            {{venta.fecha | date:'HH:mm'}}
                                        </span>
                                    </div>
                                </div>

                                <!-- Informaci√≥n Adicional -->
                                <div class="venta-details">
                                    <div class="detail-item">
                                        <small class="text-muted">Control</small>
                                        <strong class="text-primary">#{{venta.numeroControl}}</strong>
                                    </div>
                                    <div class="detail-item">
                                        <small class="text-muted">Asesor</small>
                                        <span class="text-dark">{{venta.asesor.nombre}}</span>
                                    </div>
                                    <div class="detail-item">
                                        <small class="text-muted">Forma Pago</small>
                                        <span class="text-capitalize badge forma-pago-badge" [ngClass]="{
                                    'forma-contado': venta.formaPago === 'contado',
                                    'forma-cashea': venta.formaPago === 'cashea',
                                    'forma-abono': venta.formaPago === 'abono'
                                }">
                                            {{venta.formaPago}}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Lado Derecho - Estado y Monto -->
                            <div class="venta-sidebar">
                                <!-- Estado -->
                                <div class="estado-badge" [ngClass]="{
                            'estado-completada': venta.estado === 'completada',
                            'estado-pendiente': venta.estado === 'pendiente',
                            'estado-cancelada': venta.estado === 'cancelada'
                        }">
                                    <div class="estado-dot"></div>
                                    <span class="estado-text">{{venta.estado | titlecase}}</span>
                                </div>

                                <!-- Monto -->
                                <div class="monto-display">
                                    <div class="monto-amount text-primary fw-bold">
                                        {{venta.montoTotal | currency:'USD':'symbol':'1.2-2'}}
                                    </div>
                                    <div class="monto-label text-muted small">Total</div>
                                </div>

                                <!-- √çcono Expandir -->
                                <div class="expand-icon">
                                    <i class="bi" [class.bi-chevron-down]="!venta.mostrarDetalle"
                                        [class.bi-chevron-up]="venta.mostrarDetalle"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Panel Expandible - Dise√±o Moderno -->
                        <div *ngIf="venta.mostrarDetalle" class="venta-expandible">
                            <div class="expandible-content">
                                <!-- Secci√≥n Superior: Resumen R√°pido -->
                                <div class="resumen-rapido">
                                    <div class="resumen-item">
                                        <i class="bi bi-cart-check text-primary"></i>
                                        <div>
                                            <small class="text-muted">Productos</small>
                                            <div class="fw-semibold">{{venta.productos?.length || 0}} items</div>
                                        </div>
                                    </div>
                                    <div class="resumen-item">
                                        <i class="bi bi-currency-dollar text-success"></i>
                                        <div>
                                            <small class="text-muted">Subtotal</small>
                                            <div class="fw-semibold">{{venta.subtotal | number:'1.2-2'}}</div>
                                        </div>
                                    </div>
                                    <div class="resumen-item">
                                        <i class="bi bi-percent text-warning"></i>
                                        <div>
                                            <small class="text-muted">Descuento</small>
                                            <div class="fw-semibold">{{venta.descuento || 0}}%</div>
                                        </div>
                                    </div>
                                    <div class="resumen-item">
                                        <i class="bi bi-cash-coin text-info"></i>
                                        <div>
                                            <small class="text-muted">Pagado</small>
                                            <div class="fw-semibold">{{getTotalPagadoVenta(venta) | number:'1.2-2'}}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Secci√≥n Media: Detalles Espec√≠ficos -->
                                <div class="detalles-grid">
                                    <!-- M√©todos de Pago -->
                                    <div class="detalle-seccion">
                                        <h6 class="seccion-titulo">
                                            <i class="bi bi-credit-card me-2"></i>
                                            M√©todos de Pago
                                        </h6>
                                        <div class="metodos-pago">
                                            <div *ngFor="let metodo of venta.metodosPago" class="metodo-item">
                                                <div class="metodo-icono" [ngClass]="'metodo-' + metodo.tipo">
                                                    <i class="bi" [class.bi-cash]="metodo.tipo === 'efectivo'"
                                                        [class.bi-credit-card]="metodo.tipo === 'debito' || metodo.tipo === 'credito'"
                                                        [class.bi-phone]="metodo.tipo === 'pagomovil'"
                                                        [class.bi-bank]="metodo.tipo === 'transferencia'"
                                                        [class.bi-currency-dollar]="metodo.tipo === 'zelle'"></i>
                                                </div>
                                                <div class="metodo-info">
                                                    <span class="metodo-tipo text-capitalize">{{metodo.tipo}}</span>
                                                    <span class="metodo-monto">{{metodo.monto | number:'1.2-2'}}</span>
                                                </div>
                                                <div class="metodo-conversion" *ngIf="metodo.conversionBs">
                                                    <small class="text-muted">{{metodo.conversionBs | number:'1.2-2'}}
                                                        Bs</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Informaci√≥n Adicional -->
                                    <div class="detalle-seccion">
                                        <h6 class="seccion-titulo">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Informaci√≥n Adicional
                                        </h6>
                                        <div class="info-adicional">
                                            <div class="info-item">
                                                <span class="info-label">Especialista:</span>
                                                <span class="info-value">{{venta.especialista?.nombre || 'No asignado'}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Sede:</span>
                                                <span class="info-value text-capitalize">{{venta.sede}}</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Moneda:</span>
                                                <span class="info-value text-uppercase">{{venta.moneda}}</span>
                                            </div>
                                            <div class="info-item" *ngIf="venta.observaciones">
                                                <span class="info-label">Observaciones:</span>
                                                <span class="info-value">{{venta.observaciones}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Secci√≥n Inferior: Acciones -->
                                <div class="acciones-venta">
                                    <div class="acciones-left">
                                        <span class="text-muted small">
                                            <i class="bi bi-clock-history me-1"></i>
                                            Creado el {{venta.fecha | date:'dd/MM/yyyy'}}
                                        </span>
                                    </div>
                                    <div class="acciones-right">
                                        <button class="btn btn-outline-primary btn-sm accion-btn"
                                            (click)="verRecibo(venta)">
                                            <i class="bi bi-receipt"></i>
                                            <span>Recibo</span>
                                        </button>
                                        <button *ngIf="venta.estado !== 'cancelada'"
                                            class="btn btn-outline-danger btn-sm accion-btn"
                                            (click)="cancelarVenta(venta)">
                                            <i class="bi bi-x-circle"></i>
                                            <span>Cancelar</span>
                                        </button>
                                        <button class="btn btn-outline-info btn-sm accion-btn"
                                            (click)="verDetalleCompleto(venta)">
                                            <i class="bi bi-eye"></i>
                                            <span>Detalles</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paginaci√≥n Moderna -->
        <div class="d-flex justify-content-between align-items-center mt-4 p-3 bg-light rounded-3">
            <!-- Informaci√≥n de resultados -->
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted">
                    <strong>{{ ventasFiltradas.length }}</strong> resultados
                </span>
                <div class="vr"></div>
                <span class="text-muted">
                    P√°gina <strong>{{ paginaActual }}</strong> de <strong>{{ totalPaginas }}</strong>
                </span>
            </div>

            <!-- Controles de paginaci√≥n centrados -->
            <div class="d-flex align-items-center gap-2">
                <!-- Bot√≥n Anterior -->
                <button class="btn btn-outline-primary btn-sm d-flex align-items-center gap-1"
                    (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1"
                    [class.btn-outline-secondary]="paginaActual === 1">
                    <i class="bi bi-chevron-left"></i>
                    <span class="d-none d-sm-inline">Anterior</span>
                </button>

                <!-- Selector de p√°gina r√°pida -->
                <div class="input-group input-group-sm" style="width: 120px;">
                    <span class="input-group-text bg-white">P√°g.</span>
                    <select class="form-select" [(ngModel)]="paginaActual" (change)="cambiarPagina(paginaActual)">
                        <option *ngFor="let pagina of getRangoPaginas()" [value]="pagina">
                            {{ pagina }}
                        </option>
                    </select>
                </div>

                <!-- Bot√≥n Siguiente -->
                <button class="btn btn-outline-primary btn-sm d-flex align-items-center gap-1"
                    (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual === totalPaginas"
                    [class.btn-outline-secondary]="paginaActual === totalPaginas">
                    <span class="d-none d-sm-inline">Siguiente</span>
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>

            <!-- Controles adicionales a la derecha -->
            <div class="d-flex align-items-center gap-3">
                <!-- Selector de items por p√°gina -->
                <div class="d-flex align-items-center gap-2">
                    <span class="text-muted small">Mostrar:</span>
                    <select class="form-select form-select-sm" style="width: 80px;" [(ngModel)]="itemsPorPagina"
                        (change)="cambiarItemsPorPagina()">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Paginaci√≥n M√≥vil (solo se muestra en pantallas peque√±as) -->
        <div class="d-lg-none mt-3">
            <div class="card">
                <div class="card-body py-2">
                    <div class="row align-items-center">
                        <div class="col-4">
                            <button
                                class="btn btn-outline-primary btn-sm w-100 d-flex align-items-center justify-content-center gap-1"
                                (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1">
                                <i class="bi bi-chevron-left"></i>
                                <span>Ant</span>
                            </button>
                        </div>
                        <div class="col-4 text-center">
                            <span class="text-muted small">
                                {{ paginaActual }}/{{ totalPaginas }}
                            </span>
                        </div>
                        <div class="col-4">
                            <button
                                class="btn btn-outline-primary btn-sm w-100 d-flex align-items-center justify-content-center gap-1"
                                (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual === totalPaginas">
                                <span>Sig</span>
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal de Confirmaci√≥n para Cancelar Venta -->
<ng-template #cancelarVentaModal let-modal>
    <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
            <i class="bi bi-exclamation-triangle me-2"></i>
            Confirmar Cancelaci√≥n
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()"></button>
    </div>

    <div class="modal-body">
        <!-- Cambiamos alert-warning por alert-info con fondo azul claro -->
        <div class="alert alert-info" role="alert">
            <h6 class="alert-heading fw-bold">¬øEst√° seguro de que desea cancelar esta venta?</h6>
            <p class="mb-0 mt-2">
                <strong>Venta {{ formatNumeroVenta(selectedVenta?.id) }}</strong><br>
                <span *ngIf="selectedVenta?.paciente?.nombre">Paciente: {{ selectedVenta.paciente.nombre }}</span><br>
                <span *ngIf="selectedVenta?.montoTotal">Monto: {{ selectedVenta.montoTotal | currency }}</span>
            </p>
        </div>

        <div class="form-group mt-3">
            <label for="motivoCancelacion" class="form-label">
                <strong>Motivo de cancelaci√≥n:</strong>
            </label>
            <textarea id="motivoCancelacion" class="form-control" rows="3"
                placeholder="Ingrese el motivo de la cancelaci√≥n..." [(ngModel)]="motivoCancelacion" maxlength="500">
      </textarea>
            <small class="text-muted">{{ motivoCancelacion?.length || 0 }}/500 caracteres</small>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
            <i class="bi bi-x-circle me-1"></i> Cancelar
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmarCancelacion(modal)">
            <i class="bi bi-check-circle me-1"></i> Confirmar Cancelaci√≥n
        </button>
    </div>
</ng-template>


<!-- Modal de Detalle Completo de Venta - Dise√±o Simplificado -->
<ng-template #detalleVentaModal let-modal>
  <!-- Header con gradiente -->
<div class="modal-header-detalle">
  <div class="header-content">
    <div class="header-icon">
      <i class="bi bi-file-earmark-text"></i>
    </div>
    <div class="header-text">
      <h5 class="modal-title">Detalle de Venta</h5>
      <div class="header-subtitle">
        <span class="badge badge-primary">#{{selectedVenta?.numeroControl}}</span>
        <span class="separator">‚Ä¢</span>
        <span class="fecha">{{selectedVenta?.fecha | date:'dd/MM/yyyy'}}</span>
      </div>
    </div>
  </div>
  <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()" aria-label="Cerrar"></button>
</div>

  <div class="modal-body-detalle">
    <!-- Tarjeta de Informaci√≥n Principal -->
    <div class="info-card principal">
      <div class="card-header-detalle">
        <i class="bi bi-person-circle"></i>
        <span>Informaci√≥n del Paciente</span>
      </div>
      <div class="card-body-detalle">
        <div class="info-grid">
          <div class="info-item-detalle">
            <label>Paciente</label>
            <div class="value">{{selectedVenta?.paciente?.nombre}}</div>
          </div>
          <div class="info-item-detalle">
            <label>C√©dula</label>
            <div class="value">{{selectedVenta?.paciente?.cedula}}</div>
          </div>
          <div class="info-item-detalle">
            <label>Asesor</label>
            <div class="value">{{selectedVenta?.asesorNombre}}</div>
          </div>
          <div class="info-item-detalle">
            <label>Sede</label>
            <div class="value">{{selectedVenta?.sede}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de Formulaci√≥n Cl√≠nica (si existe) -->
    <div class="info-card formulacion" *ngIf="selectedVenta?.historiaMedica?.formulacion">
      <div class="card-header-detalle">
        <i class="bi bi-eyeglasses"></i>
        <span>Formulaci√≥n Cl√≠nica</span>
      </div>
      <div class="card-body-detalle">
        <div class="formulacion-grid">
          <!-- Ojo Derecho -->
          <div class="ojo-card">
            <div class="ojo-header ojo-derecho">
              <i class="bi bi-eye"></i>
              <span>Ojo Derecho (OD)</span>
            </div>
            <div class="ojo-params">
              <div class="param">
                <span class="param-label">Esfera (Esf)</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.esf || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Cilindro (Cil)</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.cil || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Eje</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.eje || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Add</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.add || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Altura</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.alt || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">DP</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.od?.dp || '‚Äî'}}</span>
              </div>
            </div>
          </div>

          <!-- Ojo Izquierdo -->
          <div class="ojo-card">
            <div class="ojo-header ojo-izquierdo">
              <i class="bi bi-eye"></i>
              <span>Ojo Izquierdo (OI)</span>
            </div>
            <div class="ojo-params">
              <div class="param">
                <span class="param-label">Esfera (Esf)</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.esf || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Cilindro (Cil)</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.cil || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Eje</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.eje || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Add</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.add || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">Altura</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.alt || '‚Äî'}}</span>
              </div>
              <div class="param">
                <span class="param-label">DP</span>
                <span class="param-value">{{selectedVenta?.historiaMedica?.formulacion?.oi?.dp || '‚Äî'}}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recomendaciones -->
        <div class="recomendaciones" *ngIf="selectedVenta?.historiaMedica?.recomendaciones">
          <div class="recomendaciones-header">
            <i class="bi bi-stars"></i>
            <span>Recomendaciones</span>
          </div>
          <div class="recomendaciones-grid">
            <div class="recomendacion-item">
              <span class="rec-label">Montura</span>
              <span class="rec-value">{{selectedVenta?.historiaMedica?.recomendaciones?.montura || '‚Äî'}}</span>
            </div>
            <div class="recomendacion-item">
              <span class="rec-label">Material</span>
              <span class="rec-value">{{selectedVenta?.historiaMedica?.recomendaciones?.material || '‚Äî'}}</span>
            </div>
            <div class="recomendacion-item">
              <span class="rec-label">Cristal</span>
              <span class="rec-value">{{selectedVenta?.historiaMedica?.recomendaciones?.cristal || '‚Äî'}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta de Productos -->
    <div class="info-card productos">
      <div class="card-header-detalle">
        <i class="bi bi-cart"></i>
        <span>Productos y Servicios</span>
      </div>
      <div class="card-body-detalle">
        <div class="productos-list">
          <div *ngFor="let producto of selectedVenta?.productos" class="producto-item">
            <div class="producto-info">
              <div class="producto-nombre">{{producto.nombre}}</div>
              <div class="producto-codigo">C√≥digo: {{producto.codigo}}</div>
              <div class="producto-detalles">
                <span class="cantidad">{{producto.cantidad}} und</span>
                <span class="precio">{{producto.precio | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</span>
                <span *ngIf="producto.aplicaIva" class="iva-badge">+IVA</span>
              </div>
            </div>
            <div class="producto-totales">
              <div class="subtotal">{{producto.subtotal | number:'1.2-2'}}</div>
              <div class="total">{{producto.total | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta de Configuraci√≥n de Pago -->
    <div class="info-card pago">
      <div class="card-header-detalle">
        <i class="bi bi-credit-card"></i>
        <span>Configuraci√≥n de Pago</span>
      </div>
      <div class="card-body-detalle">
        <div class="pago-grid">
          <div class="pago-item">
            <label>Forma de Pago</label>
            <div class="value">{{selectedVenta?.formaPago}}</div>
          </div>
          <div class="pago-item">
            <label>Moneda</label>
            <div class="value">{{selectedVenta?.moneda}}</div>
          </div>
          <div class="pago-item">
            <label>Descuento</label>
            <div class="value">{{selectedVenta?.descuento || 0}}%</div>
          </div>
          
          <!-- Informaci√≥n espec√≠fica por tipo de pago -->
          <div *ngIf="selectedVenta?.formaPago === 'cashea'" class="cashea-info">
            <div class="pago-item">
              <label>Nivel Cashea</label>
              <div class="value">{{selectedVenta?.nivelCashea}}</div>
            </div>
            <div class="pago-item">
              <label>Monto Inicial</label>
              <div class="value">{{selectedVenta?.montoInicial | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</div>
            </div>
            <div class="pago-item">
              <label>Cuotas</label>
              <div class="value">{{selectedVenta?.cantidadCuotas}} de {{selectedVenta?.montoPorCuota | number:'1.2-2'}} c/u</div>
            </div>
          </div>

          <div *ngIf="selectedVenta?.formaPago === 'abono'" class="abono-info">
            <div class="pago-item">
              <label>Monto Abonado</label>
              <div class="value">{{selectedVenta?.montoAbonado | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</div>
            </div>
            <div class="pago-item">
              <label>Saldo Pendiente</label>
              <div class="value">{{(selectedVenta?.total - selectedVenta?.montoAbonado) | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta de M√©todos de Pago -->
    <div class="info-card metodos-pago-detalle" *ngIf="selectedVenta?.metodosPago?.length">
      <div class="card-header-detalle">
        <i class="bi bi-wallet2"></i>
        <span>M√©todos de Pago</span>
      </div>
      <div class="card-body-detalle">
        <div class="metodos-grid">
          <div *ngFor="let metodo of selectedVenta?.metodosPago" class="metodo-item-detalle">
            <div class="metodo-icono">
              <i class="bi" [class.bi-cash]="metodo.tipo === 'efectivo'"
                 [class.bi-credit-card]="metodo.tipo === 'debito' || metodo.tipo === 'credito'"
                 [class.bi-phone]="metodo.tipo === 'pagomovil'"
                 [class.bi-bank]="metodo.tipo === 'transferencia'"
                 [class.bi-currency-dollar]="metodo.tipo === 'zelle'"></i>
            </div>
            <div class="metodo-info-detalle">
              <div class="metodo-tipo">{{metodo.tipo}}</div>
              <div class="metodo-monto">{{metodo.monto | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</div>
            </div>
            <div class="metodo-conversion" *ngIf="metodo.conversionBs">
              <div class="conversion-text">{{metodo.conversionBs | number:'1.2-2'}} Bs</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tarjeta de Resumen Financiero -->
    <div class="info-card resumen">
      <div class="card-header-detalle">
        <i class="bi bi-calculator"></i>
        <span>Resumen Financiero</span>
      </div>
      <div class="card-body-detalle">
        <div class="resumen-grid">
          <div class="resumen-item">
            <span class="resumen-label">Subtotal</span>
            <span class="resumen-value">{{selectedVenta?.subtotal | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</span>
          </div>
          <div class="resumen-item" *ngIf="selectedVenta?.totalIva">
            <span class="resumen-label">IVA Total</span>
            <span class="resumen-value">{{selectedVenta?.totalIva | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</span>
          </div>
          <div class="resumen-item" *ngIf="selectedVenta?.totalDescuento">
            <span class="resumen-label">Descuento</span>
            <span class="resumen-value">-{{selectedVenta?.totalDescuento | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</span>
          </div>
          <div class="resumen-item total">
            <span class="resumen-label">Total</span>
            <span class="resumen-value">{{selectedVenta?.total | number:'1.2-2'}} {{selectedVenta?.moneda === 'dolar' ? 'USD' : 'BS'}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Observaciones -->
    <div class="info-card observaciones" *ngIf="selectedVenta?.observaciones">
      <div class="card-header-detalle">
        <i class="bi bi-chat-left-text"></i>
        <span>Observaciones</span>
      </div>
      <div class="card-body-detalle">
        <p class="observaciones-text">{{selectedVenta?.observaciones}}</p>
      </div>
    </div>
  </div>

  <!-- Footer del Modal -->
  <div class="modal-footer-detalle">
    <div class="footer-actions">
      <button type="button" class="btn btn-secondary btn-detalle" (click)="modal.dismiss()">
        <i class="bi bi-x-circle me-2"></i>
        Cerrar
      </button>
      <button type="button" class="btn btn-primary btn-detalle" *ngIf="selectedVenta?.estado !== 'cancelada'">
        <i class="bi bi-printer me-2"></i>
        Imprimir
      </button>
    </div>
  </div>
</ng-template>